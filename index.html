<!DOCTYPE html>
<html>
<head>
    <title>MLB 주가 조회 시스템</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body { font-family: 'Pretendard', sans-serif; background: #f8f9fa; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .selector { margin-bottom: 20px; padding: 10px; border-radius: 5px; border: 1px solid #ddd; font-size: 16px; }
        .chart-container { width: 90%; max-width: 800px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <h1>⚾ MLB 선수별 주가 조회</h1>
    
    <select id="playerSelect" class="selector" onchange="updateChart()">
        <option value="">선수 선택</option>
    </select>

    <div class="chart-container">
        <canvas id="stockChart"></canvas>
    </div>

    <script>
        let allData = [];
        let stockChart;

        // CSV 읽기
        Papa.parse("mlb_stock_history.csv", {
            download: true, header: true,
            complete: function(results) {
                allData = results.data;
                const players = [...new Set(allData.map(item => item.Player))];
                const select = document.getElementById('playerSelect');
                
                players.forEach(p => {
                    if(p) {
                        let opt = document.createElement('option');
                        opt.value = p; opt.innerHTML = p;
                        select.appendChild(opt);
                    }
                });
            }
        });

        function updateChart() {
            const selectedPlayer = document.getElementById('playerSelect').value;
            const filteredData = allData.filter(item => item.Player === selectedPlayer);
            
            const labels = filteredData.map(d => d.Date);
            const prices = filteredData.map(d => d.Price);

            if (stockChart) stockChart.destroy(); // 기존 차트 삭제

            const ctx = document.getElementById('stockChart').getContext('2d');
            stockChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `${selectedPlayer} 주가`,
                        data: prices,
                        borderColor: '#007bff',
                        tension: 0.3,
                        fill: true,
                        backgroundColor: 'rgba(0, 123, 255, 0.1)'
                    }]
                }
            });
        }
    </script>
</body>
</html>
