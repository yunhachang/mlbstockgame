name: MLB Stock Game Full Simulation

on:
  workflow_dispatch:

jobs:
  run-simulation:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'
          cache: 'pip'
      
      - name: Install Dependencies
        run: |
          pip install pandas numpy
      
      - name: Ensure Directory Structure
        run: mkdir -p data

      # [수정] 파일 위치를 찾아서 실행합니다 (최상위 혹은 scripts 폴더 탐색)
      - name: Step 1 - Analyze WPA
        run: |
          if [ -f "analyze_wpa.py" ]; then
            python analyze_wpa.py
          elif [ -f "scripts/analyze_wpa.py" ]; then
            python scripts/analyze_wpa.py
          else
            echo "Error: analyze_wpa.py not found in root or scripts/"
            exit 1
          fi

      - name: Step 2 - Run Simulation
        run: |
          if [ -f "run_simulation.py" ]; then
            python run_simulation.py
          elif [ -f "scripts/run_simulation.py" ]; then
            python scripts/run_simulation.py
          else
            echo "Error: run_simulation.py not found"
            exit 1
          fi
      
      - name: Commit and Push Results
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"
          git add data/*.csv
          git commit -m "chore: update simulation results [$(date +'%Y-%m-%d %H:%M')]" || echo "No changes to commit"
          git push
